<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/feedback.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800;900&display=swap">
    <script src="../js/functions.js"></script>
    <script src="../js/jquery.js"></script>
    <script src="../js/menu-responsivo.js"></script>

    <title>Feedback</title>
</head>

<body>
    <header>

        <div class="container">
            <div class="logo">
                <!-- <img src="img/TotemHub.svg" alt=""> -->
            </div>
            <!--logo-->
            <nav class="desktop-menu">
                <ul>
                    <li><a href="../index.html">Conheça nosso Site</a></li>
                    <li><a style="color: #FFC702;" href="feedback.html">Feedback</a></li>
                </ul>
            </nav>
            <nav class="mobile-menu">
                <ul>
                    <li><a href="../index.html">Conheça nosso Site</a></li>
                    <li><a style="color: #FFC702;" href="feedback.html">Feedback</a></li>
                </ul>
            </nav>
        </div>
        <!--container-->

        <div class="clear"></div>

        <div class="form-login">
            <h3>Qual estação você está?</h3>
            <form id="form_publicar" method="post" onsubmit="return publicar()">

                <label class="custom-selector">
                    <select name="estacao">
                        <option selected disabled>Selecione</option>
                        <option value="100">Consolacão</option>
                        <option value="101">Pinheiros</option>
                        <option value="102">República</option>
                    </select>
                </label>

                <h3>Como foi sua experiência conosco?</h3>

                <label class="custom-selector">
                    <select name="pontuacao">
                        <option selected disabled>Selecione</option>
                        <option value="1">Bom</option>
                        <option value="2">Indiferente</option>
                        <option value="3">Ruim</option>
                    </select>
                </label>


                <h3>Deseja deixar alguma mensagem extra? </h3>
                <div class="input-field">
                    <input type="text" name="mensagem" id="mensagem" placeholder="Deixe sua mensagem aqui">
                    <div class="underline"></div>
                </div>
                <input type="submit" id="btn_publicar">
            </form>
        </div>
    </header>
</body>

</html>

<script>
    function publicar() {
        console.log("entrei!")

        var formulario = new URLSearchParams(new FormData(form_publicar));
        // var id_feedback = sessionStorage.id_leads_meuapp;s
        fetch(`/publicacoes/cadastrar/`, {

            method: "POST",
            body: formulario
        }).then(resposta => {

            if (resposta.ok) {

                // window.location.href = 'dashborad-gerente.html';
                obterPublicacoes3();
            } else {
                console.log('Erro ao publicar!');
                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }
        });

        return false;
    }

    function obterPublicacoes() {
        fetch("/publicacoes")
            .then(resposta => {
                if (resposta.ok) {
                    resposta.json().then(function(resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        atualizarFeed(resposta);

                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                    console.log("Nenhum resultado encontrado ou erro na API");
                }
            })
            .catch(function(error) {
                console.error(`Erro na obtenção das publicações: ${error.message}`);
            });
    }

    function obterPublicacoesPorUsuario(id_feedback) {
        fetch(`/publicacoes/${id_feedback}`)
            .then(resposta => {
                if (resposta.ok) {
                    resposta.json().then(function(resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        alert(JSON.stringify(resposta))
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function(error) {
                console.error(`Erro na obtenção das publicações do usuário: ${error.message}`);
            });
    }


    // let login_usuario;
    // let nome_usuario;

    // function entrar_login() {

    //     var formulario = new URLSearchParams(new FormData(form_login));

    //     fetch("/usuarios/autenticar", {
    //         method: "POST",
    //         body: formulario
    //     }).then(resposta => {

    //         if (resposta.ok) {

    //             resposta.json().then(json => {

    //                 window.location.href = 'tabela.html';
    //             });

    //         } else {

    //             console.log('Erro de login!');
    //             alert('Login incorreto');

    //             resposta.text().then(texto => {
    //                 console.error(texto);
    //             });
    //         }
    //     });

    //     return false;
    // }

    // // function redirecionar_login() {
    // //     window.location.href = 'login.html';
    // // }

    // function verificar_autenticacao() {
    //     login = sessionStorage.login_usuario_meuapp;
    //     nome = sessionStorage.nome_usuario_meuapp;

    //     if (login == undefined) {
    //         redirecionar_login();
    //     } else {
    //         b_usuario.innerHTML = nome_usuario;
    //         console.log("nome usuário:", b_usuario.innerHTML);
    //         validar_sessao();
    //     }

    // }

    // // function logoff() {
    // //     finalizar_sessao();
    // //     sessionStorage.clear();
    // //     redirecionar_login();
    // // }

    // function validar_sessao() {
    //     fetch(`/usuarios/sessao/${login_usuario}`, {
    //             cache: 'no-store'
    //         })
    //         .then(resposta => {
    //             if (resposta.ok) {
    //                 resposta.text().then(texto => {
    //                     console.log('Sessão :) ', texto);
    //                 });
    //             } else {
    //                 console.error('Sessão :.( ');
    //                 logoff();
    //             }
    //         });
    // }

    // function finalizar_sessao() {
    //     fetch(`/usuarios/sair/${login_usuario}`, { cache: 'no-store' });
    // }
</script>