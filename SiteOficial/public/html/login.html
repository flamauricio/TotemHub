<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/login.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800;900&display=swap">
    <script src="../js/function.js"></script>
    <script src="../js/jquery.js"></script>
    <script src="../js/menu-responsivo.js"></script>
    <title>Login</title>
</head>
<body>
    <header>

        <div class="container">
            <div class="logo">
                <!-- <img src="img/TotemHub.svg" alt=""> -->
            </div><!--logo-->
            <nav class="desktop-menu">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="cadastro.html">Cadastrar</a></li>
                    <li><a style="color: #FFC702;" href="login.html">Login</a></li>
                </ul>
            </nav>

            <nav class="mobile-menu">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="cadastro.html">Cadastrar</a></li>
                    <li><a href="login.html">Login</a></li>
                </ul>
            </nav>
        </div><!--container-->

        <div  class="clear"></div>

        <div class="form-login">
            <h2>Login Gerente</h2>
            <form action="" id="form_login" method="post" onsubmit="return entrar_login()">
                <div class="input-field">
                    <input type="text" name="login" id="login" placeholder="Email">
                    <div class="underline"></div>
                </div>

                <div class="input-field">
                    <input type="password" name="senha" id="senha" placeholder="Senha">
                    <div class="underline"></div>
                </div>

                <input type="submit" value="Enter" id="btn_login">
            </form>

            <div class="login-footer">
                <span>Esqueceu sua senha? 
                    <a style="color: white;" href="https://totemhub.atlassian.net/servicedesk/customer/portal/1"> Clique Aqui! </a></span>
            </div>
        </div>


    </header>
    
</body>
</html>

<script>
    let login_usuario;
    let nome_usuario;

    function entrar_login() {

        var formulario = new URLSearchParams(new FormData(form_login));

        fetch("/usuarios/autenticar", {
            method: "POST",
            body: formulario
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    window.location.href = 'tabela.html';
                });

            } else {

                console.log('Erro de login!');
                alert('Login incorreto');

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        });

        return false;
    }

    // function redirecionar_login() {
    //     window.location.href = 'login.html';
    // }

    function verificar_autenticacao() {
        login = sessionStorage.login_usuario_meuapp;
        nome = sessionStorage.nome_usuario_meuapp;

        if (login == undefined) {
            redirecionar_login();
        } else {
            b_usuario.innerHTML = nome_usuario;
            console.log("nome usuário:",b_usuario.innerHTML);
            validar_sessao();
        }

    }

    // function logoff() {
    //     finalizar_sessao();
    //     sessionStorage.clear();
    //     redirecionar_login();
    // }

    function validar_sessao() {
        fetch(`/usuarios/sessao/${login_usuario}`, { cache: 'no-store' })
            .then(resposta => {
                if (resposta.ok) {
                    resposta.text().then(texto => {
                        console.log('Sessão :) ', texto);
                    });
                } else {
                    console.error('Sessão :.( ');
                    logoff();
                }
            });
    }

    // function finalizar_sessao() {
    //     fetch(`/usuarios/sair/${login_usuario}`, { cache: 'no-store' });
    // }


</script>